<?xml version="1.0" encoding="UTF-8"?>
<project name="mocha-go-go" default="jenkins" basedir=".">
    <property name="test_results" value="build/testResults"/>
    <property name="node_modules" value="c:/temp/node_modules/" />

    <target name="init" description="Create build folder and subfolders if required">
        <echo message="Creating Directories..." />
        <mkdir dir="build"/>
        <mkdir dir="${test_results}"/>
        <mkdir dir="${node_modules}/" />
    </target>

    <target name="cleanup" description="Remove cruft generated from testing">
    <echo message="Cleaning up..." />
    <delete includeemptydirs="true" failonerror="false">
        <fileset dir="${node_modules}">
            <include name="**" />
        </fileset>
        <fileset dir="${test_results}/">
            <include name="**" />
        </fileset>
        <fileset dir="${node_modules}">
            <include name="**" />
        </fileset>
    </delete>
    <delete includeemptydirs="true" failonerror="false">
        <fileset dir="${test_results}">
            <include name="**" />
        </fileset>
    </delete>
    </target>

    <target name="mocha-jenkins" description="Test framework">
        <echo message="Installing Deps ..." />
        <exec executable="npm.cmd" failonerror="true">
        <env key="NODE_PATH" value="${node_modules}" />
            <arg value="install" />
        </exec>
        <echo message="Running the tests ..." />
        <exec executable="mocha.cmd"  output="${test_results}/mocha.xml" failonerror="true">
            <env key="NODE_PATH" value="${node_modules}" />
            <arg value="tests" />
            <arg value="-R" />
            <arg value="xunit" />
        </exec>
        <echo message="Tests done" />
    </target>

    <target name="jenkins" depends="cleanup,init,mocha-jenkins" />
</project>
